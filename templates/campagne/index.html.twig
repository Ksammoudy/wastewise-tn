{% extends 'base.html.twig' %}
{% block title %}Campagnes | WasteWise{% endblock %}

{% block body %}
<div class="ww-app">
  {% include 'campagne/_side_user.html.twig' %}

  <main class="ww-main">
    <div class="ww-topbar">
      <div>
        <div class="ww-h1">ðŸ“£ Campagnes</div>
        <div class="ww-sub">Consulter et rejoindre une campagne</div>
      </div>
      <div class="ww-top-actions">
        <a class="ww-top-btn" href="{{ path('campagne_my') }}">âœ… Mes campagnes</a>
      </div>
    </div>

    {# âœ… Flash messages #}
    {% for label, messages in app.flashes %}
      {% for msg in messages %}
        <div class="ww-card2" style="margin-bottom:10px;">
          <b>{{ label|upper }}</b> â€” {{ msg }}
        </div>
      {% endfor %}
    {% endfor %}

    <section class="ww-card2">
      <div class="ww-card2-title">Liste</div>

      <div class="ww-list">
        {% for c in items %}

          {# Badge statut #}
          {% set badgeHtml %}
            {% if c.statut == 'ACTIVE' %}
              <span class="ww-tag ww-tag-ok">ACTIVE</span>
            {% elseif c.statut == 'BROUILLON' %}
              <span class="ww-tag ww-tag-warn">BROUILLON</span>
            {% else %}
              <span class="ww-tag ww-tag-bad">TERMINEE</span>
            {% endif %}
          {% endset %}

          <a class="ww-action" href="{{ path('campagne_show', { id: c.id }) }}">
            <div class="ww-action-ic">ðŸ“£</div>

            <div style="flex:1;">
              <div class="ww-action-title">{{ c.titre }}</div>

              <div class="ww-action-sub">
                {{ c.dateDebut ? c.dateDebut|date('d/m/Y') : 'â€”' }}
                â†’
                {{ c.dateFin ? c.dateFin|date('d/m/Y') : 'â€”' }}
                â€¢ {{ badgeHtml|raw }}

                {% if c.statut != 'ACTIVE' %}
                  <span style="opacity:.75;">â€¢ Rejoindre indisponible</span>
                {% else %}
                  <span style="opacity:.75;">â€¢ Rejoindre possible</span>
                {% endif %}
              </div>
            </div>

            <span class="ww-pill ww-info">Voir</span>
          </a>

        {% else %}
          <div style="opacity:.7;">Aucune campagne.</div>
        {% endfor %}
      </div>
    </section>

  </main>
</div>
{% endblock %}
