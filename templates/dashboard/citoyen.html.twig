{# templates/citoyen/dashboard.html.twig #}
{% extends 'citoyen/base.html.twig' %}

{% block title %}Dashboard Citoyen | WasteWise TN{% endblock %}

{% block body %}

<div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-4">
  <div>
    <h2 class="mb-0 ww-title">üè† Dashboard Citoyen</h2>
    <div class="ww-subtitle">Vue globale de votre activit√©</div>
  </div>

  <div class="d-flex gap-2 flex-wrap">
    <a class="btn btn-success" href="{{ path('dechet_nouveau') }}">
      <i class="bi bi-plus-circle"></i> D√©clarer
    </a>
    <a class="btn btn-outline-secondary" href="{{ path('citoyen_declarations') }}">
      <i class="bi bi-file-earmark-text"></i> Mes d√©clarations
    </a>
  </div>
</div>

<div class="row g-3 mb-3">
  <div class="col-12 col-md-6 col-xl-4">
    <div class="ww-card h-100">
      <div class="ww-card-b">
        <div class="text-muted mb-1">EcoPoints</div>
        <div class="fs-2 fw-bold">{{ ecoPoints|default(0) }}</div>
        <div class="small text-muted">Apr√®s validation</div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-6 col-xl-4">
    <div class="ww-card h-100">
      <div class="ww-card-b">
        <div class="text-muted mb-1">D√©clarations</div>
        <div class="fs-2 fw-bold">{{ stats.total|default(0) }}</div>
        <div class="small text-muted">
          {{ stats.enAttente|default(0) }} en attente ‚Ä¢
          {{ stats.valides|default(0) }} valid√©es ‚Ä¢
          {{ stats.refuses|default(0) }} refus√©es
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-6 col-xl-4">
    <div class="ww-card h-100">
      <div class="ww-card-b">
        <div class="text-muted mb-1">Badge</div>
        <div class="fs-2 fw-bold">{{ badge|default('D√©butant') }}</div>
        <div class="small text-muted">Continue üí™</div>
      </div>
    </div>
  </div>
</div>

<div class="ww-card">
  <div class="ww-card-h">Activit√© r√©cente</div>

  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Type</th>
          <th>Quantit√©</th>
          <th>Statut</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        {% for d in recent|default([]) %}
          <tr>
            <td>{{ d.type ?? '‚Äî' }}</td>
            <td>{{ d.quantiteKg ?? '‚Äî' }} kg</td>
            <td>
              {% set st = (d.statut ?? '') %}
              {% if st == 'VALIDE' %}
                <span class="ww-badge"><i class="bi bi-check-circle"></i> Valid√©e</span>
              {% elseif st == 'EN_ATTENTE' %}
                <span class="ww-badge"><i class="bi bi-hourglass-split"></i> En attente</span>
              {% elseif st == 'REFUSE' %}
                <span class="ww-badge"><i class="bi bi-x-circle"></i> Refus√©e</span>
              {% else %}
                <span class="text-muted">‚Äî</span>
              {% endif %}
            </td>
            <td class="text-muted small">
              {{ d.createdAt ? d.createdAt|date('d/m/Y H:i') : '‚Äî' }}
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="4" class="text-center py-4 text-muted">
              <i class="bi bi-info-circle"></i> Aucune d√©claration r√©cente.
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
