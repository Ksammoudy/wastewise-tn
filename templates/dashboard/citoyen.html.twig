{% extends 'base.html.twig' %}

{% block title %}Dashboard Citoyen | WasteWise TN{% endblock %}

{% block body %}
<div class="ww-app">

  {# ===== SIDEBAR ===== #}
  <aside class="ww-side">
    <div class="ww-side-head">
      <div class="ww-side-logo">WW</div>
      <div>
        <div class="ww-side-brand">WasteWise <span>TN</span></div>
        <div class="ww-side-tag">Espace Citoyen</div>
      </div>
    </div>

    {% set userLabel = app.user ? app.user.userIdentifier : 'InvitÃ©' %}
    {% set firstChar = userLabel|first|upper %}

    <div class="ww-side-user">
      <div class="ww-avatar">{{ firstChar }}</div>
      <div>
        <div class="ww-user-email">{{ userLabel }}</div>

        <div class="ww-user-meta">
          <span class="ww-pill ww-info">
            {{ attribute(app.user, 'type') is defined ? app.user.type : 'USER' }}
          </span>

          {% if attribute(app.user, 'isVerified') is defined and app.user.isVerified %}
            <span class="ww-pill ww-ok">âœ” VÃ©rifiÃ©</span>
          {% else %}
            <span class="ww-pill ww-warn">âš  Non vÃ©rifiÃ©</span>
          {% endif %}
        </div>
      </div>
    </div>

    <nav class="ww-side-nav">
      <a class="ww-nav-item active" href="{{ path('app_dashboard') }}">
        <span class="ww-nav-ic">ğŸ </span> Dashboard
      </a>

      <a class="ww-nav-item" href="{{ path('dechet_nouveau') }}">
        <span class="ww-nav-ic">ğŸ—‘ï¸</span> DÃ©clarer un dÃ©chet
      </a>

      <a class="ww-nav-item" href="#" onclick="alert('BientÃ´t disponible'); return false;">
        <span class="ww-nav-ic">ğŸ“„</span> Mes dÃ©clarations
      </a>

      <a class="ww-nav-item" href="#" onclick="alert('BientÃ´t disponible'); return false;">
        <span class="ww-nav-ic">ğŸ</span> RÃ©compenses
      </a>

      <div class="ww-nav-sep"></div>

      <a class="ww-nav-item danger" href="{{ path('app_logout') }}">
        <span class="ww-nav-ic">ğŸšª</span> DÃ©connexion
      </a>
    </nav>

    <div class="ww-side-foot">Â© {{ "now"|date("Y") }} WasteWise TN</div>
  </aside>

  {# ===== MAIN ===== #}
  <main class="ww-main">

    {# FLASH MESSAGES #}
    {% for msg in app.flashes('success') %}
      <div class="ww-alert" style="margin-bottom:16px;border-color:#bbf7d0;background:#ecfdf3;color:#166534;">
        {{ msg }}
      </div>
    {% endfor %}
    {% for msg in app.flashes('error') %}
      <div class="ww-alert" style="margin-bottom:16px;border-color:#fecaca;background:#fff1f2;color:#991b1b;">
        {{ msg }}
      </div>
    {% endfor %}
    {% for msg in app.flashes('info') %}
      <div class="ww-alert" style="margin-bottom:16px;border-color:#bfdbfe;background:#eff6ff;color:#1d4ed8;">
        {{ msg }}
      </div>
    {% endfor %}

    <div class="ww-topbar">
      <div>
        <div class="ww-h1">ğŸ  Dashboard Citoyen</div>
        <div class="ww-sub">
          Bienvenue <b>{{ userLabel }}</b>
        </div>
      </div>

      <div class="ww-top-actions">
        <a class="ww-top-btn primary" href="{{ path('dechet_nouveau') }}">+ Nouvelle dÃ©claration</a>
      </div>
    </div>

    {# ===== STATS ===== #}
    <div class="ww-grid-3">
      <div class="ww-stat">
        <div class="ww-stat-label">EcoPoints</div>
        <div class="ww-stat-value">{{ ecoPoints|default(0) }}</div>
        <div class="ww-stat-hint">Solde actuel</div>
      </div>

      <div class="ww-stat">
        <div class="ww-stat-label">DÃ©clarations</div>
        <div class="ww-stat-value">{{ stats.total|default(0) }}</div>
        <div class="ww-stat-hint">
          {{ stats.enAttente|default(0) }} en attente â€¢ {{ stats.valides|default(0) }} validÃ©es
        </div>
      </div>

      <div class="ww-stat">
        <div class="ww-stat-label">Badge</div>
        <div class="ww-stat-value">{{ badge|default('DÃ©butant') }}</div>
        <div class="ww-stat-hint">
          {% if ecoPoints|default(0) >= 2000 %}
            Niveau Expert
          {% elseif ecoPoints|default(0) >= 1000 %}
            Excellent progrÃ¨s
          {% elseif ecoPoints|default(0) >= 500 %}
            Bon rythme
          {% else %}
            Continue comme Ã§a ğŸ’ª
          {% endif %}
        </div>
      </div>
    </div>

    {# ===== ACTIVITÃ‰ RÃ‰CENTE ===== #}
    <section class="ww-card2">
      <div class="ww-card2-title">ActivitÃ© rÃ©cente</div>

      {% if recent|default([]) is empty %}
        <div class="ww-note">Aucune dÃ©claration pour le moment.</div>
      {% else %}
        <div class="ww-activity">
          {% for d in recent %}
            {% set tagClass =
              d.statut == 'VALIDE' ? 'ww-tag-ok' :
              (d.statut == 'REFUSE' ? 'ww-tag-bad' : 'ww-tag-warn')
            %}
            <div class="ww-activity-item">
              <span class="ww-tag {{ tagClass }}">{{ d.statut|replace({'_':' '}) }}</span>
              <div>
                <div class="ww-activity-title">{{ d.type }}</div>
                <div class="ww-activity-sub">
                  {{ d.quantiteKg }} kg â€¢
                  {{ d.createdAt|date('d/m/Y H:i') }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </section>

  </main>
</div>
{% endblock %}
