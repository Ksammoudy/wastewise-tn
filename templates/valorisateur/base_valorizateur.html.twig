{# templates/valorisateur/base_valorizateur.html.twig #}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Valorisateur | WasteWise{% endblock %}</title>

  {# Vendor CSS #}
  <link rel="stylesheet" href="{{ asset('assets/vendor/bootstrap/css/bootstrap.min.css') }}">
  <link rel="stylesheet" href="{{ asset('assets/vendor/bootstrap-icons/bootstrap-icons.css') }}">
  <link rel="stylesheet" href="{{ asset('assets/vendor/font-awesome/css/all.min.css') }}">

  {# Template CSS #}
  <link rel="stylesheet" href="{{ asset('assets/css/style.css') }}">

  <style>
    .main-wrapper{ display:flex; min-height:100vh; }
    .sidebar{
      width:280px; flex:0 0 280px;
      border-right:1px solid rgba(0,0,0,.08);
      background:#fff;
    }
    .page-wrapper{ flex:1 1 auto; min-width:0; background:#f8fafc; }
    .page-header{ position:sticky; top:0; z-index:10; }

    /* Sidebar links */
    .sidebar .nav-link{
      border-radius:10px;
      padding:.6rem .8rem;
      color:#334155;
      display:flex;
      align-items:center;
      gap:.45rem;
    }
    .sidebar .nav-link:hover{ background:rgba(2,6,23,.04); }
    .sidebar .nav-link.active{
      background:#16a34a;
      color:#fff !important;
      font-weight:700;
    }
    .sidebar .nav-link.active i{ color:#fff !important; }

    /* Responsive */
    @media (max-width: 991.98px){
      .main-wrapper{ flex-direction:column; }
      .sidebar{
        width:100%; flex:0 0 auto;
        border-right:none;
        border-bottom:1px solid rgba(0,0,0,.08);
      }
      .page-header{ position:static; }
    }
  </style>

  {% block stylesheets %}{% endblock %}
</head>

<body>

{% set route = app.request.attributes.get('_route') %}
{% set userLabel = app.user ? app.user.userIdentifier : 'User' %}
{% set firstChar = userLabel|first|upper %}

<div class="main-wrapper">

  {# ===== SIDEBAR ===== #}
  <aside class="sidebar">

    <div class="p-3 border-bottom">
      <a href="{{ path('app_dashboard_valorizateur') }}"
         class="d-flex align-items-center gap-2 text-decoration-none">
        <span class="fw-bold text-success">WasteWise TN</span>
      </a>
      <div class="small text-muted">Espace Valorisateur</div>
    </div>

    <div class="p-3 border-bottom">
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-circle d-flex align-items-center justify-content-center fw-bold"
             style="width:42px;height:42px;background:#e8f5ee;color:#166534;">
          {{ firstChar }}
        </div>

        <div class="min-w-0">
          <div class="fw-semibold text-truncate">{{ userLabel }}</div>
          <div class="small text-muted">VALORISATEUR</div>
        </div>
      </div>
    </div>

    <div class="px-2 py-3">
      <ul class="nav flex-column gap-1">

        <li class="nav-item">
          <a class="nav-link {{ route == 'app_dashboard_valorizateur' ? 'active' : '' }}"
             href="{{ path('app_dashboard_valorizateur') }}">
            <i class="bi bi-speedometer2"></i> Dashboard
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {{ route == 'app_valorizateur_historique' ? 'active' : '' }}"
             href="{{ path('app_valorizateur_historique') }}">
            <i class="bi bi-clock-history"></i> Historique
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {{ route starts with 'val_appel_' ? 'active' : '' }}"
             href="{{ path('val_appel_index') }}">
            <i class="bi bi-megaphone"></i> Appels d’offres
          </a>
        </li>

        <li class="nav-item mt-2">
          <a class="nav-link text-danger" href="{{ path('app_logout') }}">
            <i class="bi bi-box-arrow-right"></i> Déconnexion
          </a>
        </li>

      </ul>
    </div>

  </aside>

  {# ===== PAGE CONTENT ===== #}
  <div class="page-wrapper">

    <header class="page-header bg-white border-bottom px-4 py-3 d-flex align-items-center justify-content-between">
      <div class="fw-bold">Valorisateur</div>

      {% if app.user %}
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-person-circle"></i>
          <span class="small text-muted">{{ app.user.userIdentifier }}</span>
        </div>
      {% endif %}
    </header>

    <main class="px-4 py-4">

      {# Flash messages #}
      {% for label, messages in app.flashes %}
        {% for message in messages %}
          {% set bs = label == 'error' ? 'danger' : label %}
          <div class="alert alert-{{ bs }} shadow-sm mb-3">
            {{ message }}
          </div>
        {% endfor %}
      {% endfor %}

      {% block body %}{% endblock %}

    </main>

  </div>
</div>

<script src="{{ asset('assets/vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
{% block javascripts %}{% endblock %}

</body>
</html>
