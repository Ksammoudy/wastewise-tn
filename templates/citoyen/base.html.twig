{# templates/citoyen/base.html.twig #}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Citoyen | WasteWise TN{% endblock %}</title>

  {# Vendor CSS #}
  <link rel="stylesheet" href="{{ asset('assets/vendor/bootstrap/css/bootstrap.min.css') }}">
  <link rel="stylesheet" href="{{ asset('assets/vendor/bootstrap-icons/bootstrap-icons.css') }}">
  <link rel="stylesheet" href="{{ asset('assets/vendor/font-awesome/css/all.min.css') }}">
  <link rel="stylesheet" href="{{ asset('assets/vendor/overlay-scrollbar/css/OverlayScrollbars.min.css') }}">

  {# Template CSS #}
  <link rel="stylesheet" href="{{ asset('assets/css/style.css') }}">

  <style>
    :root{
      --ww-bg:#f6f8fb;
      --ww-card:#ffffff;
      --ww-text:#0f172a;
      --ww-muted:#64748b;
      --ww-border:rgba(15,23,42,.08);
      --ww-green:#2f6b4f;
      --ww-green-2:#8bd22f;
    }

    body{ background:var(--ww-bg); }
    .main-wrapper{ display:flex; min-height:100vh; }

    /* ===== Sidebar ===== */
    .sidebar{
      width:280px; flex:0 0 280px;
      background:rgba(255,255,255,.85);
      border-right:1px solid var(--ww-border);
      backdrop-filter: blur(10px);
    }
    .side-brand{
      font-weight:900;
      letter-spacing:-.3px;
      color:var(--ww-text);
    }
    .side-tag{ color:var(--ww-muted); font-size:.86rem; }

    .side-user{
      display:flex; gap:10px; align-items:center;
    }
    .side-avatar{
      width:42px;height:42px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      background:rgba(47,107,79,.12);
      color:var(--ww-green);
      font-weight:900;
    }
    .side-meta{ color:var(--ww-muted); font-size:.82rem; }

    .sidebar .nav-link{
      border-radius:12px;
      padding:.6rem .8rem;
      color:#334155;
      display:flex; align-items:center; gap:10px;
      transition:.15s ease;
    }
    .sidebar .nav-link:hover{
      background:rgba(2,6,23,.04);
      transform: translateX(2px);
    }
    .sidebar .nav-link.active{
      background:linear-gradient(90deg, var(--ww-green), var(--ww-green-2));
      color:#fff !important;
      font-weight:800;
    }
    .sidebar .nav-link.active i{ color:#fff; }

    /* ===== Page ===== */
    .page-wrapper{ flex:1 1 auto; min-width:0; background:var(--ww-bg); }
    .page-header{
      position:sticky; top:0; z-index:10;
      background:rgba(255,255,255,.9);
      border-bottom:1px solid var(--ww-border);
      backdrop-filter: blur(10px);
    }

    /* ===== UI helpers ===== */
    .ww-title{ font-weight:900; letter-spacing:-.3px; color:var(--ww-text); }
    .ww-subtitle{ color:var(--ww-muted); }

    .ww-card{
      background:var(--ww-card);
      border:1px solid rgba(0,0,0,.06);
      border-radius:18px;
      box-shadow:0 10px 30px rgba(15,23,42,.06);
    }
    .ww-card-h{
      padding:14px 16px;
      border-bottom:1px solid rgba(0,0,0,.06);
      font-weight:800;
      background:rgba(255,255,255,.7);
      border-top-left-radius:18px;
      border-top-right-radius:18px;
    }
    .ww-card-b{ padding:16px; }

    .ww-badge{
      background:#f1f5f9;
      color:#0f172a;
      border:1px solid rgba(0,0,0,.06);
      font-weight:700;
      padding:.35rem .55rem;
      border-radius:999px;
      font-size:.82rem;
      display:inline-flex;
      gap:.35rem;
      align-items:center;
      white-space:nowrap;
    }

    /* Responsive */
    @media (max-width: 991.98px){
      .main-wrapper{ flex-direction:column; }
      .sidebar{
        width:100%; flex:0 0 auto;
        border-right:none;
        border-bottom:1px solid var(--ww-border);
      }
      .page-header{ position:static; }
    }
  </style>

  {% block stylesheets %}{% endblock %}
</head>

<body>
{% set route = app.request.attributes.get('_route') %}
{% set userLabel = app.user ? app.user.userIdentifier : 'Invité' %}
{% set firstChar = userLabel|first|upper %}

<div class="main-wrapper">

  {# ===== SIDEBAR ===== #}
  <aside class="sidebar">

    <div class="p-3 border-bottom">
      <a href="{{ path('app_dashboard_citoyen') }}" class="d-flex align-items-center gap-2 text-decoration-none">
        <i class="bi bi-leaf-fill text-success"></i>
        <span class="side-brand">WasteWise <span class="text-success">TN</span></span>
      </a>
      <div class="side-tag">Espace Citoyen</div>
    </div>

    <div class="p-3 border-bottom">
      <div class="side-user">
        <div class="side-avatar">{{ firstChar }}</div>
        <div class="min-w-0">
          <div class="fw-semibold text-truncate">{{ userLabel }}</div>
          <div class="side-meta">
            {{ attribute(app.user, 'type') is defined ? app.user.type : 'CITOYEN' }}
          </div>
        </div>
      </div>
    </div>

    <div class="px-2 py-3">
      <ul class="nav flex-column gap-1">

        <li class="nav-item">
          <a class="nav-link {{ route == 'app_dashboard_citoyen' ? 'active' : '' }}"
             href="{{ path('app_dashboard_citoyen') }}">
            <i class="bi bi-house"></i> Dashboard
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {{ route in ['dechet_nouveau','citoyen_dechet_nouveau'] ? 'active' : '' }}"
             href="{{ path('dechet_nouveau') }}">
            <i class="bi bi-trash3"></i> Déclarer déchets
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {{ route == 'citoyen_declarations' ? 'active' : '' }}"
             href="{{ path('citoyen_declarations') }}">
            <i class="bi bi-file-earmark-text"></i> Mes déclarations
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {{ route == 'citoyen_impact' ? 'active' : '' }}"
             href="{{ path('citoyen_impact') }}">
            <i class="bi bi-globe-europe-africa"></i> Impact
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {{ route == 'app_citoyen_recompenses' ? 'active' : '' }}"
             href="{{ path('app_citoyen_recompenses') }}">
            <i class="bi bi-gift"></i> Récompenses
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {{ route == 'app_citoyen_recompenses_acquises' ? 'active' : '' }}"
             href="{{ path('app_citoyen_recompenses_acquises') }}">
            <i class="bi bi-award"></i> Mes récompenses
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {{ route == 'app_citoyen_campagnes' ? 'active' : '' }}"
             href="{{ path('app_citoyen_campagnes') }}">
            <i class="bi bi-megaphone"></i> Campagnes
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {{ route starts with 'cit_appel_' ? 'active' : '' }}"
             href="{{ path('cit_appel_index') }}">
            <i class="bi bi-pencil-square"></i> Appels d’offres
          </a>
        </li>

        <li class="nav-item mt-2">
          <a class="nav-link text-danger" href="{{ path('app_logout') }}">
            <i class="bi bi-box-arrow-right"></i> Déconnexion
          </a>
        </li>

      </ul>
    </div>

  </aside>

  {# ===== PAGE CONTENT ===== #}
  <div class="page-wrapper">

    <header class="page-header px-4 py-3 d-flex align-items-center justify-content-between">
      <div class="fw-bold">Citoyen</div>

      {% if app.user %}
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-person-circle"></i>
          <span class="small text-muted">{{ app.user.userIdentifier }}</span>
        </div>
      {% endif %}
    </header>

    <main class="px-4 py-4">

      {# Flash messages #}
      {% for label, messages in app.flashes %}
        {% for message in messages %}
          {% set bs = label == 'error' ? 'danger' : label %}
          <div class="alert alert-{{ bs }} shadow-sm mb-3">
            {{ message }}
          </div>
        {% endfor %}
      {% endfor %}

      {% block body %}{% endblock %}
    </main>

  </div>
</div>

<script src="{{ asset('assets/vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ asset('assets/vendor/overlay-scrollbar/js/OverlayScrollbars.min.js') }}"></script>
{% block javascripts %}{% endblock %}
</body>
</html>
