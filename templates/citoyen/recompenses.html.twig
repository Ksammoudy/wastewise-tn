{# templates/citoyen/recompenses.html.twig #}
{% extends 'citoyen/base.html.twig' %}

{% block title %}R√©compenses | WasteWise TN{% endblock %}

{% block body %}

{# ===== HEADER ===== #}
<div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-4">
  <div>
    <h2 class="mb-0 ww-title">üéÅ R√©compenses</h2>
    <div class="ww-subtitle">R√©compenses disponibles chez nos partenaires</div>
  </div>

  <a class="btn btn-outline-secondary" href="{{ path('app_dashboard_citoyen') }}">
    <i class="bi bi-arrow-left"></i> Dashboard
  </a>
</div>

{# ===== R√âSUM√â ===== #}
<div class="d-flex flex-wrap gap-2 mb-3">
  <span class="ww-badge">
    <i class="bi bi-gift"></i> Disponibles : {{ recompenses|length }}
  </span>
  <span class="ww-badge">
    <i class="bi bi-star-fill"></i> Ton solde : {{ ecoPoints|default(0) }} pts
  </span>
</div>

{# ===== CONTENU ===== #}
{% if recompenses is empty %}
  <div class="ww-card p-4 text-muted fw-semibold">
    <i class="bi bi-info-circle"></i> Aucune r√©compense disponible pour le moment.
  </div>
{% else %}

  <div class="row g-3">
    {% for r in recompenses %}
      {% set solde = ecoPoints|default(0) %}
      {% set besoin = r.pointsNecessaires|default(0) %}
      {% set stock = r.stock is null ? 0 : r.stock %}
      {% set eligible = solde >= besoin %}
      {% set rupture = stock <= 0 %}

      <div class="col-12 col-md-6 col-xl-4">
        <div class="ww-soft-card h-100 p-3 d-flex flex-column">

          <div class="d-flex align-items-start justify-content-between gap-2">
            <div class="fw-bold" style="font-size:1.05rem;">
              {{ r.titre }}
            </div>

            {% if rupture %}
              <span class="ww-badge"><i class="bi bi-x-circle"></i> Rupture</span>
            {% elseif eligible %}
              <span class="ww-badge"><i class="bi bi-check-circle"></i> √âligible</span>
            {% else %}
              <span class="ww-badge"><i class="bi bi-exclamation-triangle"></i> Pas assez</span>
            {% endif %}
          </div>

          <div class="text-muted small mt-2 d-flex flex-wrap gap-3">
            <span>
              <i class="bi bi-star-fill"></i>
              Points : <b class="text-dark">{{ besoin }}</b>
            </span>

            <span>
              <i class="bi bi-box-seam"></i>
              Stock : <b class="text-dark">{{ r.stock is null ? '‚Äî' : stock }}</b>
            </span>
          </div>

          <div class="text-muted small mt-2">
            <i class="bi bi-building"></i>
            Partenaire :
            <b class="text-dark">{{ r.partenaire ? r.partenaire.nomEntreprise : '‚Äî' }}</b>
          </div>

          <div class="mt-3 text-muted" style="line-height:1.55;">
            {{ r.description ?: 'Aucune description.' }}
          </div>

          {# ===== ACTIONS ===== #}
          <div class="mt-auto pt-3 d-flex justify-content-end gap-2 flex-wrap">

            <a class="btn btn-outline-secondary btn-sm"
               href="{{ path('app_dashboard_citoyen') }}">
              Fermer
            </a>

            {% if eligible and not rupture %}
              {# Remplace href="#" par ta route d‚Äô√©change quand elle existe #}
              <a class="btn btn-success btn-sm"
                 href="#"
                 onclick="alert('Fonction √©change √† ajouter');return false;">
                <i class="bi bi-arrow-repeat"></i> √âchanger
              </a>
            {% else %}
              <button class="btn btn-secondary btn-sm" disabled>
                <i class="bi bi-lock"></i> √âchanger
              </button>
            {% endif %}

          </div>

          {% if not eligible and besoin > solde %}
            <div class="pt-2 text-muted small">
              Il te manque <b class="text-dark">{{ (besoin - solde) }}</b> pts.
            </div>
          {% endif %}

        </div>
      </div>

    {% endfor %}
  </div>

{% endif %}

{% endblock %}
